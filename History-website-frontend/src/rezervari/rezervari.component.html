<main class="rezervari">
<!-- Borduri decorative cu modele populare rom√¢ne»ôti -->
<div class="decorative-borders">
  <div class="decorative-border-left"></div>
  <div class="decorative-border-right"></div>
</div>

<app-meniu></app-meniu>
<app-cadran>
    <h2>{{ 'rezervariTitle' | translate }}</h2>
    
    <!-- Program muzeu -->
    <div class="museum-schedule" *ngIf="currentSchedule">
        <div class="schedule-header">
            <h3>{{ 'rezervariScheduleTitle' | translate }}: <span class="season">{{ currentSchedule.seasonName }}</span></h3>
            <span class="schedule-icon" [ngClass]="{'summer': currentSchedule.seasonName === 'VarƒÉ', 'winter': currentSchedule.seasonName === 'IarnƒÉ'}">
                {{ currentSchedule.seasonName === 'VarƒÉ' ? '‚òÄÔ∏è' : '‚ùÑÔ∏è' }}
            </span>
        </div>
        <div class="schedule-content">
            <div class="schedule-row">
                <div class="schedule-day">
                    <h4>{{ 'rezervariWeekdays' | translate }}:</h4>
                    <p>{{ currentSchedule.weekdaysOpen }} - {{ currentSchedule.weekdaysClose }}</p>
                </div>
                <div class="schedule-day">
                    <h4>{{ 'rezervariWeekend' | translate }}:</h4>
                    <p>{{ currentSchedule.weekendOpen }} - {{ currentSchedule.weekendClose }}</p>
                </div>
            </div>
            <div class="schedule-notes" *ngIf="currentSchedule.specialNotes">
                <p><em>{{ currentSchedule.specialNotes }}</em></p>
            </div>
        </div>
    </div>
    
    <div class="loading-schedule" *ngIf="isLoading">
        <p>{{ 'rezervariLoading' | translate }}</p>
    </div>
    
    <div class="rezervari-container">
        <div class="form-section">
            <form (ngSubmit)="addBooking()" #bookingForm="ngForm">
                <div class="form-group">
                    <label for="nume">{{ 'rezervariLastName' | translate }}:</label>
                    <input type="text" id="nume" name="nume" [(ngModel)]="newBooking.nume" required>
                </div>
                
                <div class="form-group">
                    <label for="prenume">{{ 'rezervariFirstName' | translate }}:</label>
                    <input type="text" id="prenume" name="prenume" [(ngModel)]="newBooking.prenume" required>
                </div>
                
                <div class="form-group">
                    <label for="email">{{ 'rezervariEmail' | translate }}:</label>
                    <input type="email" id="email" name="email" 
                           [(ngModel)]="newBooking.email" 
                           required 
                           #emailInput="ngModel"
                           (input)="validateEmail()"
                           [class.invalid]="emailValidationError">
                    
                    <!-- Mesaj de validare email -->
                    <div *ngIf="emailValidationError" class="error-message">
                        {{ emailValidationError }}
                    </div>
                    
                    <!-- Indicator email valid -->
                    <div *ngIf="emailValidationSuccess" class="success-message">
                        ‚úì {{ 'rezervariEmailValid' | translate }}
                    </div>
                </div>
                
                <!-- Buton pentru calendarul inteligent -->
                <div class="form-group">
                    <div class="smart-calendar-section">
                        <h3>üìÖ Selectare datƒÉ »ôi orƒÉ</h3>
                        <button type="button" 
                                class="smart-calendar-btn" 
                                (click)="openSmartCalendar()">
                            üóìÔ∏è Deschide Calendarul
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label>{{ 'rezervariDateTime' | translate }}:</label>
                    <div class="date-time-selector">
                        <!-- Afi»ôare datƒÉ selectatƒÉ -->
                        <div class="date-select">
                            <label for="date">{{ 'rezervariDate' | translate }}:</label>
                            <input type="text" 
                                   id="date" 
                                   name="date"
                                   [(ngModel)]="selectedDate"
                                   required
                                   readonly
                                   placeholder="Se va completa din calendar..."
                                   class="date-display-readonly">
                        </div>

                        <!-- Afi»ôare orƒÉ selectatƒÉ -->
                        <div class="time-select">
                            <label for="time">{{ 'rezervariTime' | translate }}:</label>
                            <input type="text" 
                                   id="time" 
                                   name="time"
                                   [(ngModel)]="selectedTime"
                                   required
                                   readonly
                                   placeholder="Se va completa din calendar..."
                                   class="time-display-readonly">
                        </div>
                    </div>

                    <!-- Mesaj de eroare pentru data/ora -->
                    <div *ngIf="dateTimeError" class="error-message">
                        {{ dateTimeError }}
                    </div>

                    <!-- Informa»õii despre program -->
                    <div class="booking-time-info" *ngIf="currentSchedule">
                        <p>{{ 'rezervariBookingNote' | translate }}:</p>
                        <ul>
                            <li>{{ 'rezervariWeekdays' | translate }}: {{ currentSchedule.weekdaysOpen }} - {{ currentSchedule.weekdaysClose }}</li>
                            <li>{{ 'rezervariWeekend' | translate }}: {{ currentSchedule.weekendOpen }} - {{ currentSchedule.weekendClose }}</li>
                        </ul>
                    </div>

                    <!-- Input ascuns pentru a stoca valoarea datetime completƒÉ pentru backend -->
                    <input type="hidden" name="datetime" [(ngModel)]="newBooking.datetime">
                </div>
                
                <div class="form-group">
                    <label for="numberOfPersons">{{ 'rezervariNumberOfPersons' | translate }}:</label>
                    <input type="number" id="numberOfPersons" name="numberOfPersons" [(ngModel)]="newBooking.numberOfPersons" required min="1" max="50">
                </div>
                
                <div class="form-group">
                    <label for="ageGroup">Categoria de v√¢rstƒÉ pentru grup:</label>
                    <select id="ageGroup" name="ageGroup" [(ngModel)]="newBooking.ageGroup" required class="age-group-select">
                        <option value="">Selecta»õi categoria de v√¢rstƒÉ...</option>
                        <option *ngFor="let option of ageGroupOptions" [value]="option.value">
                            {{ option.icon }} {{ option.label }}
                        </option>
                    </select>
                    <div class="age-group-note">
                        <p><em>üìù Nota: Pentru grupuri cu mai multe persoane, selecta»õi categoria membrilor majoritari din grup.</em></p>
                    </div>
                </div>
                
                <div class="form-group checkbox-group">
                    <label for="guideRequired">{{ 'rezervariGuideRequired' | translate }} </label>
                    <input type="checkbox" id="guideRequired" name="guideRequired" [(ngModel)]="newBooking.guideRequired">
                </div>

                <button type="submit" [disabled]="!bookingForm.form.valid">{{ 'rezervariSubmit' | translate }}</button>
            </form>
        </div>

        <!-- Lista rezervƒÉrilor - vizibilƒÉ doar pentru administratori -->
        <div class="table-section" *ngIf="isAdmin">
            <h2>{{ 'rezervariListTitle' | translate }}</h2>
            <table>
                <thead>
                    <tr>
                        <th>{{ 'rezervariTableLastName' | translate }}</th>
                        <th>{{ 'rezervariTableFirstName' | translate }}</th>
                        <th>{{ 'rezervariTableEmail' | translate }}</th>
                        <th>{{ 'rezervariTableDateTime' | translate }}</th>
                        <th>{{ 'rezervariTableCreatedAt' | translate }}</th>
                        <th>{{ 'rezervariTablePersons' | translate }}</th>
                        <th>Categoria de v√¢rstƒÉ</th>
                        <th>{{ 'rezervariTableGuide' | translate }}</th>
                        <th>{{ 'rezervariTableStatus' | translate }}</th>
                        <th>{{ 'rezervariTableActions' | translate }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let booking of bookings">
                        <td>{{booking.nume}}</td>
                        <td>{{booking.prenume}}</td>
                        <td>{{booking.email}}</td>
                        <td>{{ booking.datetime | date: 'dd MMM' }}<br>{{ booking.datetime | date: 'yyyy, HH:mm' }}</td>
                        <td>{{ booking.createdAt | date: 'dd MMM' }}<br>{{ booking.createdAt | date: 'yyyy, HH:mm' }}</td>
                        <td>{{booking.numberOfPersons}}</td>
                        <td>{{ getAgeGroupDisplayName(booking.ageGroup) }}</td>
                        <td>{{ booking.guideRequired ? ('rezervariYes' | translate) : ('rezervariNo' | translate) }}</td>
                        <td>
                            <span class="status-badge" [ngClass]="{
                                'status-confirmed': booking.status === 'CONFIRMATA',
                                'status-pending': booking.status === 'IN_ASTEPTARE',
                                'status-approved': booking.status === 'APROBATA',
                                'status-rejected': booking.status === 'RESPINSA'
                            }">
                                {{ getStatusDisplayName(booking.status) }}
                            </span>
                        </td>
                        <td class="actions-cell">
                            <div class="action-buttons">
                                <button class="delete-btn" (click)="deleteBooking(booking.id)">{{ 'rezervariDelete' | translate }}</button>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="bookings.length === 0">
                        <td colspan="10" class="empty-table">{{ 'rezervariNoBookings' | translate }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Mesaj de confirmare pentru utilizatorii normali dupƒÉ rezervare -->
        <div *ngIf="!isAdmin" class="confirmation-message">
            <p><strong>{{ 'rezervariImportant' | translate }}</strong> {{ 'rezervariConfirmationEmail' | translate }}</p>
            <p>{{ 'rezervariActivation' | translate }}</p>
            <p>{{ 'rezervariChanges' | translate }}</p>
            <p><em>{{ 'rezervariThankYou' | translate }}</em></p>
        </div>
    </div>
</app-cadran>

<!-- Smart Calendar Popup -->
<app-smart-calendar 
    [isVisible]="showSmartCalendar"
    [selectedDate]="selectedDate"
    [isReservationMode]="true"
    (dateSelected)="onDateSelectedFromCalendar($event)"
    (dateTimeSelected)="onDateTimeSelectedFromCalendar($event)"
    (closeCalendar)="closeSmartCalendar()">
</app-smart-calendar>

</main>