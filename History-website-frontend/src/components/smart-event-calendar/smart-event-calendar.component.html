<div class="smart-event-calendar" 
     [class.visible]="isVisible" 
     [class.embedded]="isEmbedded"
     [class.popup]="!isEmbedded"
     *ngIf="isVisible">
  
  <div class="calendar-overlay" (click)="closeModal()" *ngIf="!isEmbedded"></div>
  
  <div class="calendar-container" 
       [class.embedded-container]="isEmbedded"
       [class.popup-container]="!isEmbedded"
       (click)="isEmbedded ? null : $event.stopPropagation()">
    <!-- Header -->
    <div class="calendar-header">
      <div class="header-controls">
        <button class="nav-btn" (click)="previousMonth()" [disabled]="isLoading">
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="month-year">
          <h3>{{ getMonthName() }} {{ currentYear }}</h3>
        </div>
        
        <button class="nav-btn" (click)="nextMonth()" [disabled]="isLoading">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
      
      <div class="header-actions">
        <button class="today-btn" (click)="goToToday()" [disabled]="isLoading">
          Astăzi
        </button>
        <button class="close-btn" (click)="closeModal()" *ngIf="!isEmbedded">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Loading indicator -->
    <div class="loading-indicator" *ngIf="isLoading">
      <i class="fas fa-spinner fa-spin"></i> Se încarcă...
    </div>

    <!-- Calendar -->
    <div class="calendar-grid" *ngIf="!isLoading">
      <!-- Day headers -->
      <div class="day-header" *ngFor="let dayName of dayNames">
        {{ dayName }}
      </div>
      
      <!-- Calendar days -->
      <div 
        *ngFor="let dayData of calendarDays" 
        class="calendar-day"
        [class]="getDayStatusClass(dayData)"
        [class.clickable]="!dayData.isEmpty && !dayData.isPast"
        (click)="onDayClick(dayData)">
        
        <div class="day-number" *ngIf="!dayData.isEmpty">
          {{ dayData.day }}
        </div>
        
        <div class="day-events" *ngIf="!dayData.isEmpty && dayData.totalEvents > 0">
          <!-- Liste de evenimente cu titluri pentru modul embedded -->
          <div *ngIf="isEmbedded" class="event-list">
            <div 
              *ngFor="let event of dayData.events; let i = index" 
              class="event-item-mini"
              [class]="getEventStatusClass(event)"
              [title]="event.name + ' - ' + event.participants + '/' + event.capacity + ' participanți'"
              (click)="onEventClick(event)">
              <div class="event-name-mini">{{ event.name }}</div>
              <div class="event-capacity-mini">{{ event.participants }}/{{ event.capacity }}</div>
            </div>
          </div>
          
          <!-- Indicatori pentru modul popup -->
          <div *ngIf="!isEmbedded">
            <div class="events-count">
              {{ dayData.totalEvents }} event{{ dayData.totalEvents !== 1 ? 'e' : '' }}
            </div>
            
            <div class="events-indicators">
              <div 
                *ngFor="let event of dayData.events" 
                class="event-indicator"
                [class]="getEventStatusClass(event)"
                [title]="event.name + ' - ' + event.participants + '/' + event.capacity">
              </div>
            </div>
            
            <div class="available-spots" *ngIf="dayData.totalAvailableSpots > 0">
              {{ dayData.totalAvailableSpots }} locuri
            </div>
          </div>
        </div>
        
        <div class="no-events" *ngIf="!dayData.isEmpty && dayData.totalEvents === 0 && !dayData.isPast">
          <small>Fără evenimente</small>
        </div>
      </div>
    </div>

    <!-- Legend -->
    <div class="calendar-legend" *ngIf="!isLoading">
      <div class="legend-title">Legendă ocupare evenimente:</div>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-color available-day"></div>
          <span>Disponibil (0-9%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color very-low-day"></div>
          <span>Foarte puțin (10-24%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color low-day"></div>
          <span>Puțin ocupat (25-39%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color medium-day"></div>
          <span>Moderat (40-54%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color high-day"></div>
          <span>Foarte ocupat (55-69%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color very-high-day"></div>
          <span>Aproape plin (70-84%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color full-day"></div>
          <span>Complet (85-100%)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color past-day"></div>
          <span>Date trecute</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Day Details Popup - doar în modul non-embedded -->
  <div class="day-details-popup" *ngIf="!isEmbedded && showDayDetails && selectedDayData" (click)="closeDayDetails()">
    <div class="popup-content" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h4>{{ selectedDayData.day }} {{ getMonthName() }} {{ currentYear }}</h4>
        <button class="close-btn" (click)="closeDayDetails()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="popup-body">
        <div class="day-summary">
          <div class="summary-item">
            <span class="label">Total evenimente:</span>
            <span class="value">{{ selectedDayData.totalEvents }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Locuri disponibile:</span>
            <span class="value">{{ selectedDayData.totalAvailableSpots }}</span>
          </div>
        </div>
        
        <div class="events-list">
          <div 
            *ngFor="let event of selectedDayData.events" 
            class="event-item"
            [class]="getEventStatusClass(event)"
            (click)="onEventClick(event)">
            
            <div class="event-info">
              <div class="event-name">{{ event.name }}</div>
              <div class="event-capacity">
                {{ event.participants }}/{{ event.capacity }} participanți 
                ({{ event.percentage }}%)
              </div>
              <div class="event-status-message">
                {{ getEventStatusMessage(event) }}
              </div>
            </div>
            
            <div class="event-actions" *ngIf="canParticipate(event)">
              <button class="participate-btn">
                Înscrie-te
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>