<full-calendar [options]="calendarOptions"></full-calendar>

<!-- Modal pentru adăugare eveniment -->
<div class="event-modal" *ngIf="showEventModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Adaugă eveniment nou</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="eventForm">
        <div class="form-group">
          <label for="eventName">Numele evenimentului:</label>
          <input 
            type="text" 
            id="eventName" 
            formControlName="name" 
            placeholder="Introdu numele evenimentului"
            class="form-control">
          <div class="error-message" *ngIf="eventForm.get('name')?.invalid && eventForm.get('name')?.touched">
            Numele evenimentului este obligatoriu
          </div>
        </div>
        
        <div class="form-group">
          <label for="eventDescription">Descriere:</label>
          <textarea 
            id="eventDescription" 
            formControlName="description" 
            placeholder="Descriere eveniment"
            class="form-control"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="eventType">Tipul:</label>
          <select id="eventType" formControlName="eventType" class="form-control">
            <option value="eveniment">Eveniment</option>
            <option value="expozitie">Expoziție temporară</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="startDate">Data început:</label>
          <input 
            type="date" 
            id="startDate" 
            formControlName="startDate" 
            class="form-control date-input">
          <div class="error-message" *ngIf="eventForm.get('startDate')?.invalid && eventForm.get('startDate')?.touched">
            Data de început este obligatorie
          </div>
          <div class="error-message" *ngIf="eventForm.errors?.['startDateOutOfRange']">
            Data de început trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label for="endDate">Data sfârșit:</label>
          <input 
            type="date" 
            id="endDate" 
            formControlName="endDate" 
            class="form-control date-input">
          <div class="error-message" *ngIf="eventForm.get('endDate')?.invalid && eventForm.get('endDate')?.touched">
            Data de sfârșit este obligatorie
          </div>
          <div class="error-message" *ngIf="eventForm.errors?.['dateOrder']">
            Data de sfârșit trebuie să fie după data de început
          </div>
          <div class="error-message" *ngIf="eventForm.errors?.['endDateOutOfRange']">
            Data de sfârșit trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label>Adaugă imagini:</label>
          <div class="image-upload">
            <label for="imageUpload" class="upload-btn">
              <span>Selectează imagini</span>
              <input 
                type="file" 
                id="imageUpload" 
                accept="image/*" 
                (change)="onFileSelected($event)" 
                class="file-input">
            </label>
            <div *ngIf="selectedFile" class="selected-file">
              {{ selectedFile.name }}
              <button type="button" class="upload-action-btn" (click)="uploadImage()">Încarcă</button>
              <button type="button" class="upload-action-btn cancel" (click)="cancelUpload()">Anulează</button>
            </div>
          </div>
          
          <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="upload-progress">
            <div class="progress-bar" [style.width.%]="uploadProgress"></div>
            <span class="progress-text">{{ uploadProgress }}%</span>
          </div>
          
          <div *ngIf="selectedImages.length > 0" class="selected-images">
            <h4>Imagini selectate:</h4>
            <div class="image-list">
              <div class="image-item" *ngFor="let image of selectedImages; let i = index">
                <div class="image-preview">
                  <img [src]="'http://localhost:8080/api/images/uploads/' + image.path" alt="Preview">
                </div>
                <span>{{ image.path | slice:0:20 }}{{ image.path.length > 20 ? '...' : '' }}</span>
                <button type="button" class="remove-btn" (click)="removeImage(i)">Șterge</button>
              </div>
            </div>
          </div>
        </div>
        
      </form>
    </div>
    
    <div class="form-actions">
      <button 
        type="button" 
        class="cancel-btn" 
        (click)="closeModal()">
        Anulează
      </button>
      <button 
        type="button" 
        class="save-btn" 
        [disabled]="eventForm.invalid"
        (click)="saveEvent()">
        Salvează
      </button>
    </div>
  </div>
</div>

<!-- Modal pentru afișare detalii eveniment -->
<div class="event-details-modal" *ngIf="showEventDetailsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ selectedEvent?.title }}</h3>
      <button class="close-btn" (click)="closeEventDetailsModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="event-date">
        <span class="label">Data:</span> 
        <span class="value">{{ selectedEvent?.start | date:'dd MMMM yyyy' }} - {{ selectedEvent?.end | date:'dd MMMM yyyy' }}</span>
      </div>
      <div class="event-location" *ngIf="selectedEvent?.extendedProps?.location">
        <span class="label">Locație:</span>
        <span class="value">{{ selectedEvent?.extendedProps?.location }}</span>
      </div>
      <div class="event-description" *ngIf="selectedEvent?.extendedProps?.description">
        <span class="label">Descriere:</span>
        <p class="value">{{ selectedEvent?.extendedProps?.description }}</p>
      </div>
      <div class="event-images" *ngIf="selectedEvent?.extendedProps?.images && selectedEvent?.extendedProps?.images.length > 0">
        <h4>Galerie imagini:</h4>
        <div class="gallery-container">
          <div class="gallery-main-image">
            <img [src]="'http://localhost:8080/api/images/uploads/' + selectedEvent?.extendedProps?.images[currentImageIndex].path"
                 [alt]="selectedEvent?.extendedProps?.images[currentImageIndex].description || 'Imagine eveniment'">
          </div>

          <div class="gallery-navigation" *ngIf="selectedEvent?.extendedProps?.images.length > 1">
            <button class="gallery-nav-button prev" (click)="prevImage()" [disabled]="currentImageIndex === 0">
              &#10094;
            </button>
            <div class="gallery-indicator">
              {{ currentImageIndex + 1 }} / {{ selectedEvent?.extendedProps?.images.length }}
            </div>
            <button class="gallery-nav-button next" (click)="nextImage()" [disabled]="currentImageIndex === selectedEvent?.extendedProps?.images.length - 1">
              &#10095;
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal footer removed, using only the X button in the header -->
  </div>
</div>
