<full-calendar [options]="calendarOptions"></full-calendar>

<div class="event-modal" *ngIf="showEventModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Adaugă eveniment nou</h3>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="eventForm">
        <div class="form-group">
          <label for="eventName" class="required-label">
            Numele evenimentului:
            <span class="required-asterisk">*</span>
          </label>
          <input 
            type="text" 
            id="eventName" 
            formControlName="name" 
            placeholder="Introdu numele evenimentului"
            [class.form-control]="true"
            [class.error-field]="eventForm.get('name')?.invalid && eventForm.get('name')?.touched">
        </div>
        
        <div class="form-group">
          <label for="eventDescription" class="required-label">
            Descriere:
            <span class="required-asterisk">*</span>
          </label>
          <textarea 
            id="eventDescription" 
            formControlName="description" 
            placeholder="Descriere eveniment"
            [class.form-control]="true"
            [class.error-field]="eventForm.get('description')?.invalid && eventForm.get('description')?.touched"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="eventLocation">Locația:</label>
          <input 
            type="text" 
            id="eventLocation" 
            formControlName="location" 
            placeholder="Introdu locația evenimentului"
            class="form-control">
        </div>
        
        <div class="form-group">
          <label for="eventType">Tipul:</label>
          <select id="eventType" formControlName="eventType" class="form-control">
            <option value="eveniment">Eveniment</option>
            <option value="expozitie">Expoziție temporară</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="startDate" class="required-label">
            Data început:
            <span class="required-asterisk">*</span>
          </label>
          <input 
            type="date" 
            id="startDate" 
            formControlName="startDate" 
            [class.form-control]="true"
            [class.date-input]="true"
            [class.error-field]="eventForm.get('startDate')?.invalid && eventForm.get('startDate')?.touched">
          <div class="error-message" *ngIf="eventForm.errors?.['startDateOutOfRange']">
            Data de început trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label for="endDate" class="required-label">
            Data sfârșit:
            <span class="required-asterisk">*</span>
          </label>
          <input 
            type="date" 
            id="endDate" 
            formControlName="endDate" 
            [class.form-control]="true"
            [class.date-input]="true"
            [class.error-field]="eventForm.get('endDate')?.invalid && eventForm.get('endDate')?.touched">
          <div class="error-message" *ngIf="eventForm.errors?.['dateOrder']">
            Data de sfârșit trebuie să fie după data de început
          </div>
          <div class="error-message" *ngIf="eventForm.errors?.['endDateOutOfRange']">
            Data de sfârșit trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label>Adaugă imagini:</label>
          <div class="image-upload">
            <label for="imageUpload" class="upload-btn">
              <span>Selectează imagini</span>
              <input 
                type="file" 
                id="imageUpload" 
                accept="image/*" 
                (change)="onFileSelected($event)" 
                class="file-input">
            </label>
            <div *ngIf="selectedFile" class="selected-file">
              {{ selectedFile.name }}
              <button type="button" class="upload-action-btn" (click)="uploadImage()">Încarcă</button>
              <button type="button" class="upload-action-btn cancel" (click)="cancelUpload()">Anulează</button>
            </div>
          </div>
          
          <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="upload-progress">
            <div class="progress-bar" [style.width.%]="uploadProgress"></div>
            <span class="progress-text">{{ uploadProgress }}%</span>
          </div>
          
          <div *ngIf="selectedImages.length > 0" class="selected-images">
            <h4>Imagini selectate:</h4>
            <div class="image-list">
              <div class="image-item" *ngFor="let image of selectedImages; let i = index">
                <div class="image-preview">
                  <img [src]="'http://localhost:8080/api/images/uploads/' + image.path" alt="Preview" loading="lazy">
                </div>
                <span>{{ image.path | slice:0:20 }}{{ image.path.length > 20 ? '...' : '' }}</span>
                <button type="button" class="remove-btn" (click)="removeImage(i)">Șterge</button>
              </div>
            </div>
          </div>
        </div>
        
      </form>
    </div>
    
    <div class="form-error" *ngIf="formError">
      <div class="error-message-box">
        <pre class="error-content">{{ formError }}</pre>
      </div>
    </div>
    
    <div class="form-actions">
      <button 
        type="button" 
        class="cancel-btn" 
        (click)="closeModal()">
        Anulează
      </button>
      <button 
        type="button" 
        class="save-btn" 
        [disabled]="eventForm.invalid"
        (click)="saveEvent()">
        Salvează
      </button>
    </div>
  </div>
</div>

<div class="event-details-modal" *ngIf="showEventDetailsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ selectedEvent?.title }}</h3>
      <button class="close-btn" (click)="closeEventDetailsModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="event-date">
        <span class="label">Data:</span> 
        <span class="value">{{ selectedEvent?.start | date:'dd MMMM yyyy' }} - {{ selectedEvent?.end | date:'dd MMMM yyyy' }}</span>
      </div>
      <div class="event-location" *ngIf="selectedEvent?.extendedProps?.location">
        <span class="label">Locație:</span>
        <span class="value">{{ selectedEvent?.extendedProps?.location }}</span>
      </div>
      <div class="event-description" *ngIf="selectedEvent?.extendedProps?.description">
        <span class="label">Descriere:</span>
        <p class="value">{{ selectedEvent?.extendedProps?.description }}</p>
      </div>
      <div class="event-images" *ngIf="selectedEvent?.extendedProps?.images && selectedEvent?.extendedProps?.images.length > 0">
        <h4>Galerie imagini:</h4>
        <div class="gallery-container">
          <div class="gallery-main-image">
            <img [src]="'http://localhost:8080/api/images/uploads/' + selectedEvent?.extendedProps?.images[currentImageIndex].path"
                 [alt]="selectedEvent?.extendedProps?.images[currentImageIndex].description || 'Imagine eveniment'" loading="lazy">
          </div>

          <div class="gallery-navigation" *ngIf="selectedEvent?.extendedProps?.images.length > 1">
            <button class="gallery-nav-button prev" (click)="prevImage()" [disabled]="currentImageIndex === 0">
              &#10094;
            </button>
            <div class="gallery-indicator">
              {{ currentImageIndex + 1 }} / {{ selectedEvent?.extendedProps?.images.length }}
            </div>
            <button class="gallery-nav-button next" (click)="nextImage()" [disabled]="currentImageIndex === selectedEvent?.extendedProps?.images.length - 1">
              &#10095;
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>


<div class="event-modal" *ngIf="showEditEventModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Editare eveniment</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form [formGroup]="editEventForm">
        <div class="form-group">
          <label for="editEventName">Numele evenimentului:</label>
          <input 
            type="text" 
            id="editEventName" 
            formControlName="name" 
            placeholder="Introdu numele evenimentului"
            class="form-control">
          <div class="error-message" *ngIf="editEventForm.get('name')?.invalid && editEventForm.get('name')?.touched">
            Numele evenimentului este obligatoriu
          </div>
        </div>
        
        <div class="form-group">
          <label for="editEventDescription">Descriere:</label>
          <textarea 
            id="editEventDescription" 
            formControlName="description" 
            placeholder="Descriere eveniment"
            class="form-control"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="editEventLocation">Locația:</label>
          <input 
            type="text" 
            id="editEventLocation" 
            formControlName="location" 
            placeholder="Introdu locația evenimentului"
            class="form-control">
        </div>
        
        <div class="form-group">
          <label for="editStartDate">Data început:</label>
          <input 
            type="date" 
            id="editStartDate" 
            formControlName="startDate" 
            class="form-control date-input">
          <div class="error-message" *ngIf="editEventForm.get('startDate')?.invalid && editEventForm.get('startDate')?.touched">
            Data de început este obligatorie
          </div>
          <div class="error-message" *ngIf="editEventForm.errors?.['startDateOutOfRange']">
            Data de început trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label for="editEndDate">Data sfârșit:</label>
          <input 
            type="date" 
            id="editEndDate" 
            formControlName="endDate" 
            class="form-control date-input">
          <div class="error-message" *ngIf="editEventForm.get('endDate')?.invalid && editEventForm.get('endDate')?.touched">
            Data de sfârșit este obligatorie
          </div>
          <div class="error-message" *ngIf="editEventForm.errors?.['dateOrder']">
            Data de sfârșit trebuie să fie după data de început
          </div>
          <div class="error-message" *ngIf="editEventForm.errors?.['endDateOutOfRange']">
            Data de sfârșit trebuie să fie în intervalul permis
          </div>
        </div>
        
        <div class="form-group">
          <label>Imagini existente:</label>
          <div *ngIf="editEventImages.length > 0" class="selected-images">
            <div class="image-list">
              <div class="image-item" *ngFor="let image of editEventImages; let i = index">
                <div class="image-preview">
                  <img [src]="'http://localhost:8080/api/images/uploads/' + image.path" alt="Preview" loading="lazy">
                </div>
                <span>{{ image.path | slice:0:20 }}{{ image.path.length > 20 ? '...' : '' }}</span>
                <button type="button" class="remove-btn" (click)="removeEditImage(i)">Șterge</button>
              </div>
            </div>
          </div>
          
          <label class="mt-3">Adaugă imagini noi:</label>
          <div class="image-upload">
            <label for="editImageUpload" class="upload-btn">
              <span>Selectează imagini</span>
              <input 
                type="file" 
                id="editImageUpload" 
                accept="image/*" 
                (change)="onEditFileSelected($event)" 
                class="file-input">
            </label>
            <div *ngIf="editSelectedFile" class="selected-file">
              {{ editSelectedFile.name }}
              <button type="button" class="upload-action-btn" (click)="uploadEditImage()">Încarcă</button>
              <button type="button" class="upload-action-btn cancel" (click)="cancelEditUpload()">Anulează</button>
            </div>
          </div>
          
          <div *ngIf="editUploadProgress > 0 && editUploadProgress < 100" class="upload-progress">
            <div class="progress-bar" [style.width.%]="editUploadProgress"></div>
            <span class="progress-text">{{ editUploadProgress }}%</span>
          </div>
        </div>
        
      </form>
    </div>
    
    <div class="form-actions">
      <button 
        type="button" 
        class="cancel-btn" 
        (click)="closeEditModal()">
        Anulează
      </button>
      <button 
        type="button" 
        class="save-btn" 
        [disabled]="editEventForm.invalid"
        (click)="saveEditedEvent()">
        Salvează
      </button>
    </div>
  </div>
</div>