<main class="evenimente">
<!-- Borduri decorative cu modele populare românești -->
<div class="decorative-borders">
  <div class="decorative-border-left"></div>
  <div class="decorative-border-right"></div>
</div>

<app-meniu></app-meniu>
<app-cadran>
  <h2>{{ 'eventsCalendarTitle' | translate }}</h2>
  <div class="evenimente-container">
      
      <div *ngIf="isAdmin" class="admin-controls">
        <div class="events-description admin-desc">
          <p>{{ 'eventsAdminDescription' | translate }}</p>
          <button class="toggle-list-btn" (click)="toggleEventsList()">
            {{ showEventsList ? ('eventsHideList' | translate) : ('eventsShowList' | translate) }}
          </button>
        </div>
        
        <div *ngIf="showEventsList" class="events-list-container">
          <h3>{{ 'eventsListTitle' | translate }}</h3>
          <div class="events-list">
            <table class="events-table">
              <thead>
                <tr>
                  <th>{{ 'eventsTableId' | translate }}</th>
                  <th>{{ 'eventsTableName' | translate }}</th>
                  <th>{{ 'eventsTableStartDate' | translate }}</th>
                  <th>{{ 'eventsTableEndDate' | translate }}</th>
                  <th>{{ 'eventsTableLocation' | translate }}</th>
                  <th>{{ 'eventsTableDescription' | translate }}</th>
                  <th>{{ 'eventsTableImages' | translate }}</th>
                  <th>{{ 'eventsTableActions' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let event of events">
                  <td>{{ event.id }}</td>
                  <td>{{ event.name }}</td>
                  <td>{{ event.startDate | date:'dd.MM.yyyy' }}</td>
                  <td>{{ event.endDate | date:'dd.MM.yyyy' }}</td>
                  <td>{{ event.location }}</td>
                  <td class="description-cell">
                    <div class="truncated-text" [title]="event.description">
                      {{ event.description ? (event.description | slice:0:50) + (event.description.length > 50 ? '...' : '') : ('eventsNoDescription' | translate) }}
                    </div>
                  </td>
                  <td>{{ event.images?.length || 0 }}</td>
                  <td class="actions-cell">
                    <button class="edit-btn" (click)="editEvent(event)" [title]="'eventsEditTooltip' | translate">
                      <span class="edit-icon">✏️</span>
                    </button>
                    <button class="delete-btn" (click)="deleteEvent(event.id)" [title]="'eventsDeleteTooltip' | translate">
                      <span class="delete-icon">🗑️</span>
                    </button>
                  </td>
                </tr>
                <tr *ngIf="events.length === 0">
                  <td colspan="8" class="no-data">{{ 'eventsNoEvents' | translate }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <div *ngIf="!isAdmin" class="user-controls">
        <div class="events-description">
          <p>{{ 'eventsUserDescription' | translate }}</p>
        </div>
      </div>
      
      <div class="calendar-container">
        <!-- Calendarul Clasic pentru Admini (pentru crearea evenimentelor) -->
        <app-calendar *ngIf="isAdmin"></app-calendar>
        
        <!-- Calendarul Inteligent pentru utilizatori obișnuiți -->
        <app-smart-event-calendar
          *ngIf="!isAdmin"
          [isVisible]="true"
          [isEmbedded]="true"
          [isParticipantMode]="true"
          [maxCapacityPerEvent]="100"
          (eventSelected)="onSmartCalendarEventSelected($event)">
        </app-smart-event-calendar>
      </div>
    
    </div>
    
    <div class="events-info">
      <div class="event-info-box">
        <div class="event-icon">📅</div>
        <h3>{{ 'eventsVisitUsTitle' | translate }}</h3>
        <p>{{ 'eventsVisitUsDesc' | translate }}</p>
      </div>
      
      <div class="event-info-box">
        <div class="event-icon">🎭</div>
        <h3>{{ 'eventsSpecialTitle' | translate }}</h3>
        <p>{{ 'eventsSpecialDesc' | translate }}</p>
      </div>
      
      <div class="event-info-box">
        <div class="event-icon">🔔</div>
        <h3>{{ 'eventsAnnouncementsTitle' | translate }}</h3>
        <p>{{ 'eventsAnnouncementsDesc' | translate }}</p>
      </div>
    </div>
  
</app-cadran>

<!-- Modal pentru detaliile evenimentului -->
<div *ngIf="showEventDetailsModal" class="modal-overlay" (click)="closeEventDetailsModal()">
  <div class="modal-content event-details-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Detalii eveniment</h3>
      <button class="close-btn" (click)="closeEventDetailsModal()">&times;</button>
    </div>
    
    <div *ngIf="selectedEvent" class="event-full-details">
      <div class="event-main-info">
        <h2 class="event-title">{{ selectedEvent.name }}</h2>
        
        <div class="event-meta">
          <div class="meta-item">
            <i class="icon">📅</i>
            <span class="label">Data începerii:</span>
            <span class="value">{{ selectedEvent.startDate | date:'dd.MM.yyyy HH:mm' }}</span>
          </div>
          
          <div class="meta-item" *ngIf="selectedEvent.endDate">
            <i class="icon">🏁</i>
            <span class="label">Data încheierii:</span>
            <span class="value">{{ selectedEvent.endDate | date:'dd.MM.yyyy HH:mm' }}</span>
          </div>
          
          <div class="meta-item" *ngIf="selectedEvent.location">
            <i class="icon">📍</i>
            <span class="label">Locația:</span>
            <span class="value">{{ selectedEvent.location }}</span>
          </div>
          
          <div class="meta-item" *ngIf="selectedEvent.capacity">
            <i class="icon">👥</i>
            <span class="label">Capacitate:</span>
            <span class="value">{{ selectedEvent.participants || 0 }}/{{ selectedEvent.capacity }} participanți</span>
          </div>
          
          <div class="meta-item" *ngIf="selectedEvent.availableSpots !== undefined">
            <i class="icon">✅</i>
            <span class="label">Locuri disponibile:</span>
            <span class="value">{{ selectedEvent.availableSpots }}</span>
          </div>
        </div>
        
        <div class="event-description" *ngIf="selectedEvent.description">
          <h4>Descriere</h4>
          <p>{{ selectedEvent.description }}</p>
        </div>
      </div>
      
      <!-- Galerie foto -->
      <div class="event-gallery" *ngIf="selectedEvent.images && selectedEvent.images.length > 0">
        <h4>Galerie foto</h4>
        <div class="image-gallery">
          <div *ngFor="let image of selectedEvent.images" class="gallery-item">
            <img [src]="'http://localhost:8080/api/images/uploads/' + image.path" 
                 [alt]="image.description || 'Imagine din eveniment'"
                 class="gallery-image"
                 (click)="openImageModal(image)"
                 loading="lazy">
          </div>
        </div>
      </div>
      
      <!-- Buton de înscriere -->
      <div class="event-actions">
        <div class="availability-status" 
             [ngClass]="selectedEvent.availableSpots === 0 ? 'full' : (selectedEvent.availableSpots <= 5 ? 'limited' : 'available')">
          <span *ngIf="selectedEvent.availableSpots === 0" class="status-message">
            🚫 Eveniment complet
          </span>
          <span *ngIf="selectedEvent.availableSpots > 0 && selectedEvent.availableSpots <= 5" class="status-message">
            ⚠️ Doar {{ selectedEvent.availableSpots }} locuri rămase!
          </span>
          <span *ngIf="selectedEvent.availableSpots > 5" class="status-message">
            ✅ {{ selectedEvent.availableSpots }} locuri disponibile
          </span>
        </div>
        
        <button class="register-btn" 
                [disabled]="selectedEvent.availableSpots === 0"
                (click)="showEventRegistration()">
          <i class="btn-icon">✉️</i>
          {{ selectedEvent.availableSpots === 0 ? 'Complet' : 'Înscrie-te la eveniment' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pentru înregistrarea la evenimente -->
<div *ngIf="showRegistrationModal" class="modal-overlay" (click)="closeRegistrationModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Înregistrare la eveniment</h3>
      <button class="close-btn" (click)="closeRegistrationModal()">&times;</button>
    </div>
    
    <div *ngIf="selectedEvent" class="event-details">
      <h4>{{ selectedEvent.name }}</h4>
      <p><strong>📅 Data:</strong> {{ selectedEvent.startDate | date:'dd.MM.yyyy HH:mm' }}</p>
      <p><strong>📍 Locația:</strong> {{ selectedEvent.location }}</p>
      <p *ngIf="selectedEvent.description"><strong>📝 Descriere:</strong> {{ selectedEvent.description }}</p>
    </div>
    
    <form (ngSubmit)="registerForEvent()" class="registration-form">
      <div class="form-group">
        <label for="nume">Nume *</label>
        <input
          type="text"
          id="nume"
          [(ngModel)]="registrationForm.nume"
          name="nume"
          required
          placeholder="Introduceți numele dumneavoastră"
        />
      </div>
      
      <div class="form-group">
        <label for="prenume">Prenume *</label>
        <input
          type="text"
          id="prenume"
          [(ngModel)]="registrationForm.prenume"
          name="prenume"
          required
          placeholder="Introduceți prenumele dumneavoastră"
        />
      </div>
      
      <div class="form-group">
        <label for="email">Email *</label>
        <input
          type="email"
          id="email"
          [(ngModel)]="registrationForm.email"
          name="email"
          required
          placeholder="nume@exemplu.com"
        />
      </div>
      
      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="closeRegistrationModal()">
          Anulează
        </button>
        <button type="submit" class="submit-btn">
          Înscrie-te
        </button>
      </div>
    </form>
  </div>
</div>


<!-- Modal pentru imaginea mărită -->
<div *ngIf="showImageModal" class="image-modal-overlay" (click)="closeImageModal()">
  <div class="image-modal-content" (click)="$event.stopPropagation()">
    <button class="image-close-btn" (click)="closeImageModal()">&times;</button>
    <img [src]="'http://localhost:8080/api/images/uploads/' + selectedImage?.path" 
         [alt]="selectedImage?.description || 'Imagine din eveniment'"
         class="modal-image">
  </div>
</div>

<!-- Sistem de notificări -->
<div *ngIf="notification.show" class="notification-overlay">
  <div class="notification" [ngClass]="'notification-' + notification.type">
    <div class="notification-header">
      <span class="notification-icon">
        <span *ngIf="notification.type === 'success'">✅</span>
        <span *ngIf="notification.type === 'error'">❌</span>
        <span *ngIf="notification.type === 'warning'">⚠️</span>
      </span>
      <h4 class="notification-title">{{ notification.title }}</h4>
      <button class="notification-close" (click)="hideNotification()">&times;</button>
    </div>
    <p class="notification-message">{{ notification.message }}</p>
  </div>
</div>

</main>
