<div class="smart-calendar" *ngIf="isVisible">
  <!-- Overlay pentru a închide calendarul când se face click în afara lui -->
  <div class="calendar-overlay" (click)="onCloseCalendar()">
    <div class="calendar-container" (click)="$event.stopPropagation()">
  <!-- Header cu navigare -->
  <div class="calendar-header">
    <button class="nav-btn" (click)="previousMonth()">‹</button>
    <h2 class="month-title">{{ monthNames[currentMonth] }} {{ currentYear }}</h2>
    <button class="nav-btn" (click)="nextMonth()">›</button>
    <button class="today-btn" (click)="goToToday()">Astăzi</button>
    <button class="close-btn" (click)="onCloseCalendar()">×</button>
  </div>

  <!-- Legenda -->
  <div class="calendar-legend">
    <div class="legend-item">
      <span class="legend-color available"></span>
      <span>Disponibil (sub 50% intervale ocupate)</span>
    </div>
    <div class="legend-item">
      <span class="legend-color partial"></span>
      <span>Parțial ocupat (peste 50% intervale rezervate)</span>
    </div>
    <div class="legend-item">
      <span class="legend-color full"></span>
      <span>Complet ocupat (toate intervalele pline)</span>
    </div>
    <div class="legend-item">
      <span class="legend-color past"></span>
      <span>Date depășite (nu se pot selecta)</span>
    </div>
  </div>

  <!-- Zilele săptămânii -->
  <div class="calendar-weekdays">
    <div class="weekday" *ngFor="let day of weekDays">{{ day }}</div>
  </div>

  <!-- Calendarul propriu-zis -->
  <div class="calendar-grid">
    <div 
      *ngFor="let dayData of calendarDays" 
      [class]="getDayClass(dayData)"
      (click)="onDayClick(dayData)"
      [title]="!dayData.isEmpty ? (dayData.isPastOrToday ? 'Data depășită - nu se pot face rezervări' : getStatusText(dayData.status) + ' - ' + dayData.availableSlots + ' locuri disponibile') : ''">
      
      <span class="day-number" *ngIf="!dayData.isEmpty">{{ dayData.day }}</span>
      
      <!-- Indicator de status -->
      <div class="day-indicator" *ngIf="!dayData.isEmpty">
        <span class="status-emoji">{{ getStatusEmoji(dayData.status) }}</span>
        <span class="available-count">{{ dayData.availableSlots }}</span>
      </div>
    </div>
  </div>

  <!-- Popup cu detaliile zilei -->
  <div class="day-details-overlay" *ngIf="showDayDetails" (click)="closeDayDetails()">
    <div class="day-details-popup" (click)="$event.stopPropagation()" *ngIf="selectedDay">
      <div class="popup-header">
        <h3>{{ selectedDay.day }} {{ monthNames[currentMonth] }} {{ currentYear }}</h3>
        <button class="close-btn" (click)="closeDayDetails()">×</button>
      </div>
      
      <div class="popup-content">
        <div class="status-summary">
          <div class="status-badge" [class]="'badge-' + selectedDay.status">
            {{ getStatusEmoji(selectedDay.status) }} {{ getStatusText(selectedDay.status) }}
          </div>
          <p><strong>{{ selectedDay.availableSlots }}</strong> locuri disponibile din <strong>{{ selectedDay.totalSlots }}</strong></p>
        </div>

        <!-- Detalii pe intervale orare -->
        <div class="time-slots" *ngIf="selectedDay.timeSlots">
          <h4>{{ isReservationMode ? 'Selectează un interval orar:' : 'Disponibilitate pe intervale:' }}</h4>
          <div class="slot-list">
            <div 
              *ngFor="let slot of selectedDay.timeSlots | keyvalue" 
              class="time-slot"
              [class]="'slot-' + (getSlotValue(slot.value) >= 2 ? 'full' : getSlotValue(slot.value) === 1 ? 'partial' : 'available') + (isReservationMode && getSlotValue(slot.value) < 2 ? ' clickable' : '')"
              [style.cursor]="isReservationMode && getSlotValue(slot.value) < 2 ? 'pointer' : 'default'"
              (click)="onTimeSlotClick(slot)">
              <span class="slot-time">{{ slot.key }}</span>
              <span class="slot-count">{{ getSlotValue(slot.value) }}/2</span>
              <span class="slot-status">
                {{ getSlotValue(slot.value) >= 2 ? '🔴 Ocupat' : getSlotValue(slot.value) === 1 ? '⚠️ 1 loc rămas' : '✅ Disponibil' }}
              </span>
              <span *ngIf="isReservationMode && getSlotValue(slot.value) < 2" class="click-hint">👆 Click pentru selecție</span>
            </div>
          </div>
        </div>

        <!-- Mesaj pentru modul rezervări -->
        <div class="popup-actions" *ngIf="isReservationMode">
          <div class="instruction-text">
            <p><strong>💡 Selectează un interval orar de mai sus pentru a completa rezervarea</strong></p>
          </div>
        </div>

        <!-- Butoane pentru modul standalone -->
        <div class="popup-actions" *ngIf="!isReservationMode">
          <button 
            class="reserve-btn" 
            *ngIf="selectedDay.availableSlots > 0"
            (click)="makeReservation(selectedDay.dateStr)">
            Rezervă pentru această zi
          </button>
          <p *ngIf="selectedDay.availableSlots === 0" class="no-slots">
            Nu mai sunt locuri disponibile pentru această zi
          </p>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>